http:
  routers:
    # Router untuk Jenkins (akses via IP)
    jenkins:
      rule: "PathPrefix(`/jenkins`)"
      service: jenkins-service
      middlewares:
        - jenkins-headers

    # Router untuk project lainnya
    project1:
      rule: "PathPrefix(`/project1`)"
      service: project1-service
      middlewares:
        - project1-stripprefix

    project2:
      rule: "PathPrefix(`/project2`)"
      service: project2-service
      middlewares:
        - project2-stripprefix

    # K6 Dashboard router (k6.localhost subdomain)
    k6-dashboard:
      rule: "Host(`k6.localhost`)"
      service: k6-dashboard-service
      priority: 100

    # K6 Grafana integration - Host-based (original)
    k6-grafana:
      rule: "Host(`k6.localhost`) && PathPrefix(`/grafana`)"
      service: k6-grafana-service
      priority: 200

    # Grafana router - Path-based for IP access (NEW)
    grafana-ip:
      rule: "PathPrefix(`/grafana`)"
      service: k6-grafana-service
      middlewares:
        - grafana-stripprefix
      priority: 150

    # Prometheus router - Path-based for IP access (NEW)
    prometheus-ip:
      rule: "PathPrefix(`/prometheus`)"
      service: prometheus-service
      middlewares:
        - prometheus-stripprefix
      priority: 150

  middlewares:
    jenkins-headers:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "http"
          X-Forwarded-Port: "58002"
        
    project1-stripprefix:
      stripPrefix:
        prefixes:
          - "/project1"

    project2-stripprefix:
      stripPrefix:
        prefixes:
          - "/project2"

    # New middleware for Grafana path stripping
    grafana-stripprefix:
      stripPrefix:
        prefixes:
          - "/grafana"

    # New middleware for Prometheus path stripping
    prometheus-stripprefix:
      stripPrefix:
        prefixes:
          - "/prometheus"

    k6-cors:
      headers:
        accessControlAllowMethods:
          - GET
          - OPTIONS
          - PUT
          - POST
          - DELETE
        accessControlAllowOriginList:
          - "*"
        accessControlAllowHeaders:
          - "*"

  services:
    jenkins-service:
      loadBalancer:
        servers:
          - url: "http://jenkins:8080"

    project1-service:
      loadBalancer:
        servers:
          - url: "http://project1-app:3000"

    project2-service:
      loadBalancer:
        servers:
          - url: "http://project2-app:8000"

    k6-dashboard-service:
      loadBalancer:
        servers:
          - url: "http://k6-dashboard:3001"

    k6-grafana-service:
      loadBalancer:
        servers:
          - url: "http://test-grafana:3000"

    # Prometheus service for path-based access (NEW)
    prometheus-service:
      loadBalancer:
        servers:
          - url: "http://prometheus:9090"